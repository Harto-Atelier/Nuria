<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NURIA SPEAK</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: #0a0a0a;
            color: #ffffff;
            width: 720px;
            height: 720px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        /* Grid background */
        .grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(77, 87, 160, 0.08) 1px, transparent 1px),
                linear-gradient(90deg, rgba(77, 87, 160, 0.08) 1px, transparent 1px);
            background-size: 30px 30px;
            pointer-events: none;
        }
        
        /* Avatar section */
        .avatar-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
            z-index: 10;
        }
        
        .name {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 8px;
            color: #ffffff;
            margin-bottom: 30px;
        }
        
        .avatar-container {
            position: relative;
            width: 180px;
            height: 180px;
        }
        
        /* Pulsing ring */
        .pulse-ring {
            position: absolute;
            top: -20px;
            left: -20px;
            width: 220px;
            height: 220px;
            border: 2px solid rgba(255, 107, 0, 0.3);
            border-radius: 50%;
            animation: pulse 1.5s ease-out infinite;
        }
        
        .pulse-ring:nth-child(2) {
            animation-delay: 0.5s;
        }
        
        .pulse-ring:nth-child(3) {
            animation-delay: 1s;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .pulse-ring.idle {
            animation: none;
            opacity: 0.3;
        }
        
        /* Core avatar */
        .core {
            width: 180px;
            height: 180px;
            background: linear-gradient(135deg, #FF6B00 0%, #FF8533 50%, #FF6B00 100%);
            position: relative;
            box-shadow: 
                0 0 60px rgba(255, 107, 0, 0.4),
                0 0 100px rgba(255, 107, 0, 0.2);
            transition: transform 0.1s ease;
        }
        
        .core.speaking {
            animation: speak 0.15s ease-in-out infinite alternate;
        }
        
        @keyframes speak {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }
        
        /* Grid overlay on core */
        .core::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.15) 1px, transparent 1px);
            background-size: 22.5px 22.5px;
        }
        
        /* Waveform visualizer */
        .waveform {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            height: 80px;
            margin-bottom: 40px;
        }
        
        .bar {
            width: 6px;
            background: linear-gradient(180deg, #FF6B00, #4d57a0);
            border-radius: 3px;
            transition: height 0.05s ease;
        }
        
        /* Subtitle area */
        .subtitle-area {
            width: 90%;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 30px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(77, 87, 160, 0.3);
            position: relative;
        }
        
        .subtitle {
            font-size: 24px;
            line-height: 1.5;
            text-align: center;
            color: #ffffff;
            max-width: 100%;
        }
        
        .subtitle .word {
            display: inline-block;
            opacity: 0.4;
            transition: opacity 0.2s ease;
        }
        
        .subtitle .word.active {
            opacity: 1;
            color: #FF6B00;
        }
        
        .subtitle .word.spoken {
            opacity: 1;
        }
        
        /* Status indicator */
        .status {
            position: absolute;
            bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            color: #4d57a0;
            letter-spacing: 2px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: #00FF88;
            border-radius: 50%;
            animation: blink 1.5s ease-in-out infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Branding */
        .branding {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 10px;
            color: #333;
            letter-spacing: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="grid"></div>
        
        <div class="branding">HARTO COMMAND CENTER</div>
        
        <div class="avatar-section">
            <div class="name">NURIA</div>
            <div class="avatar-container">
                <div class="pulse-ring idle"></div>
                <div class="pulse-ring idle"></div>
                <div class="pulse-ring idle"></div>
                <div class="core"></div>
            </div>
        </div>
        
        <div class="waveform" id="waveform">
            <!-- Bars generated by JS -->
        </div>
        
        <div class="subtitle-area">
            <div class="subtitle" id="subtitle"></div>
        </div>
        
        <div class="status">
            <div class="status-dot"></div>
            <span>SPEAKING</span>
        </div>
    </div>
    
    <script>
        // Generate waveform bars
        const waveform = document.getElementById('waveform');
        const numBars = 32;
        for (let i = 0; i < numBars; i++) {
            const bar = document.createElement('div');
            bar.className = 'bar';
            bar.style.height = '10px';
            waveform.appendChild(bar);
        }
        const bars = document.querySelectorAll('.bar');
        
        // Get elements
        const core = document.querySelector('.core');
        const pulseRings = document.querySelectorAll('.pulse-ring');
        const subtitleEl = document.getElementById('subtitle');
        
        // URL params
        const params = new URLSearchParams(window.location.search);
        const text = params.get('text') || 'Hola, soy Nuria.';
        const audioUrl = params.get('audio');
        
        // Prepare subtitle words
        const words = text.split(' ');
        subtitleEl.innerHTML = words.map((w, i) => `<span class="word" data-index="${i}">${w}</span>`).join(' ');
        const wordEls = document.querySelectorAll('.word');
        
        // Audio context for visualization
        let audioContext, analyser, dataArray;
        
        function initAudio(audioElement) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 64;
            
            const source = audioContext.createMediaElementSource(audioElement);
            source.connect(analyser);
            analyser.connect(audioContext.destination);
            
            dataArray = new Uint8Array(analyser.frequencyBinCount);
        }
        
        function visualize() {
            if (!analyser) return;
            
            analyser.getByteFrequencyData(dataArray);
            
            let sum = 0;
            bars.forEach((bar, i) => {
                const value = dataArray[i] || 0;
                const height = Math.max(10, (value / 255) * 70);
                bar.style.height = height + 'px';
                sum += value;
            });
            
            // Animate core based on audio level
            const avg = sum / bars.length;
            if (avg > 30) {
                core.classList.add('speaking');
                pulseRings.forEach(r => r.classList.remove('idle'));
            } else {
                core.classList.remove('speaking');
            }
            
            requestAnimationFrame(visualize);
        }
        
        // Subtitle timing (rough estimate based on text length)
        function animateSubtitles(duration) {
            const wordDuration = duration / words.length;
            
            wordEls.forEach((el, i) => {
                setTimeout(() => {
                    // Remove active from previous
                    wordEls.forEach(w => w.classList.remove('active'));
                    // Add active to current
                    el.classList.add('active');
                    el.classList.add('spoken');
                }, i * wordDuration * 1000);
            });
        }
        
        // If audio URL provided, play it
        if (audioUrl) {
            const audio = new Audio(audioUrl);
            audio.crossOrigin = 'anonymous';
            
            audio.addEventListener('canplaythrough', () => {
                initAudio(audio);
                audio.play();
                visualize();
                animateSubtitles(audio.duration);
            });
            
            audio.addEventListener('ended', () => {
                core.classList.remove('speaking');
                pulseRings.forEach(r => r.classList.add('idle'));
            });
        } else {
            // Demo mode - simulate waveform
            let frame = 0;
            function demoVisualize() {
                frame++;
                bars.forEach((bar, i) => {
                    const height = 10 + Math.sin(frame * 0.1 + i * 0.3) * 30 + Math.random() * 20;
                    bar.style.height = height + 'px';
                });
                
                if (frame % 10 < 5) {
                    core.classList.add('speaking');
                    pulseRings.forEach(r => r.classList.remove('idle'));
                }
                
                requestAnimationFrame(demoVisualize);
            }
            demoVisualize();
            
            // Demo subtitle animation
            let wordIndex = 0;
            setInterval(() => {
                wordEls.forEach(w => w.classList.remove('active'));
                if (wordIndex < wordEls.length) {
                    wordEls[wordIndex].classList.add('active');
                    wordEls[wordIndex].classList.add('spoken');
                    wordIndex++;
                }
            }, 500);
        }
    </script>
</body>
</html>
