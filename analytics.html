<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics - Harto Command</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'JetBrains Mono', monospace;
      background: #0a0a0a;
      color: #e0e0e0;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      background: linear-gradient(135deg, #4d57a0 0%, #3a4380 100%);
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px rgba(77, 87, 160, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .subtitle {
      opacity: 0.8;
      font-size: 14px;
    }

    .live-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255,255,255,0.1);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
    }

    .pulse-dot {
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .metric-card {
      background: #1a1a1a;
      border: 2px solid #2a2a2a;
      border-radius: 12px;
      padding: 24px;
      transition: all 0.3s ease;
    }

    .metric-card:hover {
      border-color: #4d57a0;
      transform: translateY(-2px);
    }

    .metric-label {
      font-size: 12px;
      opacity: 0.6;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .metric-value {
      font-size: 48px;
      font-weight: 700;
      background: linear-gradient(135deg, #4d57a0 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .metric-change {
      font-size: 14px;
      margin-top: 8px;
    }

    .metric-change.positive {
      color: #22c55e;
    }

    .metric-change.negative {
      color: #ef4444;
    }

    .chart-container {
      background: #1a1a1a;
      border: 2px solid #2a2a2a;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 30px;
    }

    .chart-header {
      margin-bottom: 20px;
    }

    .chart-title {
      font-size: 20px;
      font-weight: 700;
    }

    .progress-bar {
      height: 8px;
      background: #2a2a2a;
      border-radius: 4px;
      overflow: hidden;
      margin: 12px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4d57a0 0%, #3b82f6 100%);
      transition: width 0.5s ease;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      background: #0f0f0f;
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .stat-label {
      opacity: 0.7;
    }

    .stat-value {
      font-weight: 600;
    }

    nav {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: flex;
      gap: 12px;
    }

    .nav-btn {
      background: linear-gradient(135deg, #4d57a0 0%, #3a4380 100%);
      border: none;
      color: white;
      padding: 16px 24px;
      border-radius: 30px;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(77, 87, 160, 0.4);
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .nav-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 24px rgba(77, 87, 160, 0.5);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>üìä Analytics Dashboard</h1>
        <div class="subtitle">Real-time team performance metrics</div>
      </div>
      <div class="live-indicator">
        <div class="pulse-dot"></div>
        <span>LIVE</span>
      </div>
    </header>

    <div class="metrics-grid" id="metricsGrid">
      <!-- Metrics will be populated by JavaScript -->
    </div>

    <!-- Market Watch Section -->
    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">üåç Market Watch</div>
      </div>
      <div class="metrics-grid" id="marketMetrics">
        <!-- Market metrics will be populated by JavaScript -->
      </div>
    </div>

    <!-- Social Media Analytics Section -->
    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">üê¶ Social Media Analytics</div>
      </div>
      <div class="metrics-grid" id="socialMetrics" style="margin-bottom: 20px;">
        <!-- Social metrics will be populated by JavaScript -->
      </div>
      <div style="margin-top: 20px;">
        <div style="font-size: 16px; font-weight: 600; margin-bottom: 16px; opacity: 0.8;">Recent Performance</div>
        <div id="topTweets"></div>
      </div>
      <div style="margin-top: 20px; text-align: center; opacity: 0.5; font-size: 11px;">
        <span id="socialLastUpdate">Last updated: Never</span>
      </div>
    </div>

    <!-- Sales Analytics Section -->
    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">üí∞ Sales Analytics</div>
      </div>
      <div class="metrics-grid" id="salesMetrics" style="margin-bottom: 20px;">
        <!-- Sales metrics will be populated by JavaScript -->
      </div>
      <div style="margin-top: 20px;">
        <div style="font-size: 16px; font-weight: 600; margin-bottom: 16px; opacity: 0.8;">Recent Sales</div>
        <div id="recentSales"></div>
      </div>
      <div style="margin-top: 30px;">
        <div style="font-size: 16px; font-weight: 600; margin-bottom: 16px; opacity: 0.8;">Top Collections</div>
        <div id="topCollections"></div>
      </div>
    </div>

    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">Task Queue Status</div>
      </div>
      <div id="queueStats"></div>
    </div>

    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">Team Performance</div>
      </div>
      <div id="teamStats"></div>
    </div>

    <nav>
      <a href="team-status-live.html" class="nav-btn">üë• Team</a>
      <button class="nav-btn" onclick="location.reload()">üîÑ Refresh</button>
    </nav>
  </div>

  <script>
    let analytics = null;
    let marketData = null;
    let salesData = null;
    let socialData = null;

    async function fetchMarketData() {
      try {
        // Fetch BTC price from CoinGecko (free API)
        const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true&include_market_cap=true');
        const data = await response.json();
        
        marketData = {
          btcPrice: data.bitcoin.usd,
          btcChange24h: data.bitcoin.usd_24h_change,
          btcMarketCap: data.bitcoin.usd_market_cap
        };
        
        renderMarketMetrics();
      } catch (error) {
        console.error('Error fetching market data:', error);
        // Show fallback UI
        document.getElementById('marketMetrics').innerHTML = `
          <div class="metric-card" style="grid-column: 1 / -1; text-align: center; opacity: 0.5;">
            Unable to load market data. Check connection.
          </div>
        `;
      }
    }

    function renderMarketMetrics() {
      if (!marketData) return;

      const marketMetrics = document.getElementById('marketMetrics');
      const changeColor = marketData.btcChange24h > 0 ? 'positive' : 'negative';
      const changeIcon = marketData.btcChange24h > 0 ? '‚Üë' : '‚Üì';
      
      marketMetrics.innerHTML = `
        <div class="metric-card">
          <div class="metric-label">‚Çø Bitcoin Price</div>
          <div class="metric-value">$${marketData.btcPrice.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</div>
          <div class="metric-change ${changeColor}">
            ${changeIcon} ${Math.abs(marketData.btcChange24h).toFixed(2)}% (24h)
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Market Cap</div>
          <div class="metric-value">$${(marketData.btcMarketCap / 1e9).toFixed(1)}B</div>
          <div class="metric-change" style="opacity: 0.5;">
            Global market dominance
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-label">24h Performance</div>
          <div class="metric-value" style="color: ${marketData.btcChange24h > 0 ? '#22c55e' : '#ef4444'}">
            ${marketData.btcChange24h > 0 ? '+' : ''}${marketData.btcChange24h.toFixed(2)}%
          </div>
          <div class="metric-change" style="opacity: 0.5;">
            ${marketData.btcChange24h > 5 ? 'üî• Hot momentum' : marketData.btcChange24h < -5 ? '‚ùÑÔ∏è Cool down' : 'üìä Steady'}
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Ordinals Market</div>
          <div class="metric-value" style="font-size: 24px;">Active</div>
          <div class="metric-change" style="opacity: 0.5;">
            <a href="https://magiceden.io/ordinals" target="_blank" style="color: #4d57a0; text-decoration: none;">View on Magic Eden ‚Üí</a>
          </div>
        </div>
      `;
    }

    async function fetchSalesData() {
      try {
        const response = await fetch('data/sales.json');
        salesData = await response.json();
        renderSalesAnalytics();
      } catch (error) {
        console.error('Error fetching sales data:', error);
        document.getElementById('salesMetrics').innerHTML = `
          <div class="metric-card" style="grid-column: 1 / -1; text-align: center; opacity: 0.5;">
            Unable to load sales data.
          </div>
        `;
      }
    }

    function renderSalesAnalytics() {
      if (!salesData || !salesData.sales) return;

      const sales = salesData.sales;
      
      // Calculate metrics
      const totalSales = sales.length;
      const totalRevenue = sales.reduce((sum, sale) => sum + sale.price, 0);
      const avgPrice = totalRevenue / totalSales;
      const lastSaleDate = sales[0]?.date || 'N/A';
      
      // Render key metrics
      const salesMetrics = document.getElementById('salesMetrics');
      salesMetrics.innerHTML = `
        <div class="metric-card">
          <div class="metric-label">Total Sales</div>
          <div class="metric-value">${totalSales}</div>
          <div class="metric-change" style="opacity: 0.5;">All-time</div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Total Revenue</div>
          <div class="metric-value">${totalRevenue.toFixed(2)} ‚Çø</div>
          <div class="metric-change" style="opacity: 0.5;">Bitcoin</div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Average Price</div>
          <div class="metric-value">${avgPrice.toFixed(3)} ‚Çø</div>
          <div class="metric-change" style="opacity: 0.5;">Per sale</div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Last Sale</div>
          <div class="metric-value" style="font-size: 20px;">${lastSaleDate}</div>
          <div class="metric-change" style="opacity: 0.5;">Most recent</div>
        </div>
      `;

      // Render recent sales table (top 5)
      const recentSales = document.getElementById('recentSales');
      const recentSalesHTML = sales.slice(0, 5).map(sale => `
        <div class="stat-row">
          <div>
            <div style="font-weight: 600;">${sale.collection} ${sale.tokenId}</div>
            <div style="font-size: 11px; opacity: 0.5;">Inscription #${sale.inscription}</div>
          </div>
          <div style="text-align: right;">
            <div style="font-weight: 600; color: #22c55e;">${sale.price} ‚Çø</div>
            <div style="font-size: 11px; opacity: 0.5;">${sale.date}</div>
          </div>
        </div>
      `).join('');
      recentSales.innerHTML = recentSalesHTML;

      // Calculate top collections
      const collectionStats = {};
      sales.forEach(sale => {
        if (!collectionStats[sale.collection]) {
          collectionStats[sale.collection] = {
            name: sale.collection,
            sales: 0,
            revenue: 0
          };
        }
        collectionStats[sale.collection].sales++;
        collectionStats[sale.collection].revenue += sale.price;
      });

      const topCollectionsData = Object.values(collectionStats)
        .map(col => ({
          ...col,
          avgPrice: col.revenue / col.sales
        }))
        .sort((a, b) => b.revenue - a.revenue);

      // Render top collections
      const topCollections = document.getElementById('topCollections');
      const topCollectionsHTML = topCollectionsData.map(col => `
        <div class="stat-row">
          <div>
            <div style="font-weight: 600;">${col.name}</div>
            <div style="font-size: 11px; opacity: 0.5;">${col.sales} sales ‚Ä¢ Avg: ${col.avgPrice.toFixed(3)} ‚Çø</div>
          </div>
          <div style="text-align: right;">
            <div style="font-weight: 600; color: #4d57a0;">${col.revenue.toFixed(2)} ‚Çø</div>
            <div style="font-size: 11px; opacity: 0.5;">Total revenue</div>
          </div>
        </div>
      `).join('');
      topCollections.innerHTML = topCollectionsHTML;
    }

    async function fetchSocialData() {
      // Sample data - will be replaced with real Twitter API integration later
      socialData = {
        profile: {
          handle: '@harto_art',
          followers: 68245,
          following: 892,
          tweets: 5432,
          joinDate: 'June 2019',
          verified: true
        },
        growth: {
          followersWeek: 245,
          followersWeekPercent: 0.36,
          followersMonth: 1120,
          followersMonthPercent: 1.67
        },
        engagement: {
          avgLikes: 189,
          avgRetweets: 42,
          avgReplies: 18,
          engagementRate: 2.8
        },
        topTweets: [
          {
            text: 'New generative piece dropping this week. Pure geometry, pure emotion.',
            likes: 523,
            retweets: 78,
            replies: 34,
            date: '2 days ago',
            engagementRate: 4.2
          },
          {
            text: 'The intersection of code and canvas. Building something special.',
            likes: 412,
            retweets: 65,
            replies: 28,
            date: '4 days ago',
            engagementRate: 3.8
          },
          {
            text: 'Ordinals marketplace update coming soon. Stay tuned.',
            likes: 398,
            retweets: 89,
            replies: 45,
            date: '5 days ago',
            engagementRate: 4.1
          }
        ]
      };

      renderSocialMetrics();
      updateSocialTimestamp();
    }

    function renderSocialMetrics() {
      if (!socialData) return;

      const socialMetrics = document.getElementById('socialMetrics');
      const changeClass = socialData.growth.followersWeekPercent > 0 ? 'positive' : 'negative';
      const changeSymbol = socialData.growth.followersWeekPercent > 0 ? '‚Üë' : '‚Üì';

      socialMetrics.innerHTML = `
        <div class="metric-card">
          <div class="metric-label">Followers</div>
          <div class="metric-value">${socialData.profile.followers.toLocaleString()}</div>
          <div class="metric-change ${changeClass}">
            ${changeSymbol} ${socialData.growth.followersWeek.toLocaleString()} this week (+${socialData.growth.followersWeekPercent}%)
          </div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Engagement Rate</div>
          <div class="metric-value">${socialData.engagement.engagementRate}%</div>
          <div style="font-size: 11px; opacity: 0.6; margin-top: 8px;">
            ‚ù§Ô∏è ${socialData.engagement.avgLikes} avg likes<br>
            üîÑ ${socialData.engagement.avgRetweets} avg retweets
          </div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Total Tweets</div>
          <div class="metric-value">${socialData.profile.tweets.toLocaleString()}</div>
          <div style="font-size: 11px; opacity: 0.6; margin-top: 8px;">
            Account since ${socialData.profile.joinDate}
          </div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Monthly Growth</div>
          <div class="metric-value">+${socialData.growth.followersMonth.toLocaleString()}</div>
          <div class="metric-change positive">
            ‚Üë ${socialData.growth.followersMonthPercent}% this month
          </div>
        </div>
      `;

      // Render top tweets
      const topTweets = document.getElementById('topTweets');
      const topTweetsHTML = socialData.topTweets.map(tweet => `
        <div class="stat-row" style="flex-direction: column; align-items: flex-start; gap: 12px;">
          <div style="width: 100%;">
            <div style="font-size: 13px; line-height: 1.5; margin-bottom: 8px;">"${tweet.text}"</div>
            <div style="display: flex; gap: 20px; font-size: 11px; opacity: 0.6;">
              <span>‚ù§Ô∏è ${tweet.likes}</span>
              <span>üîÑ ${tweet.retweets}</span>
              <span>üí¨ ${tweet.replies}</span>
              <span style="margin-left: auto;">${tweet.date}</span>
            </div>
          </div>
          <div style="width: 100%; height: 4px; background: #2a2a2a; border-radius: 2px; overflow: hidden;">
            <div style="width: ${tweet.engagementRate * 10}%; height: 100%; background: linear-gradient(90deg, #4d57a0 0%, #3b82f6 100%);"></div>
          </div>
        </div>
      `).join('');
      topTweets.innerHTML = topTweetsHTML;
    }

    function updateSocialTimestamp() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
      document.getElementById('socialLastUpdate').textContent = `Last updated: ${timeString}`;
    }

    async function fetchAnalytics() {
      try {
        const response = await fetch('data/analytics.json');
        analytics = await response.json();
        renderMetrics();
        renderCharts();
      } catch (error) {
        console.error('Error fetching analytics:', error);
      }
    }

    function renderMetrics() {
      if (!analytics) return;

      const metricsGrid = document.getElementById('metricsGrid');
      const metrics = [
        {
          label: 'Completion Rate',
          value: analytics.metrics.completionRate + '%',
          change: null
        },
        {
          label: 'Active Agents',
          value: analytics.metrics.activeAgents,
          change: null
        },
        {
          label: 'Tasks/Hour',
          value: analytics.trends.tasksPerHour,
          change: null
        },
        {
          label: 'Utilization',
          value: analytics.trends.utilizationRate + '%',
          change: null
        }
      ];

      metricsGrid.innerHTML = metrics.map(metric => `
        <div class="metric-card">
          <div class="metric-label">${metric.label}</div>
          <div class="metric-value">${metric.value}</div>
          ${metric.change ? `<div class="metric-change ${metric.change > 0 ? 'positive' : 'negative'}">
            ${metric.change > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(metric.change)}%
          </div>` : ''}
        </div>
      `).join('');
    }

    function renderCharts() {
      if (!analytics) return;

      // Queue stats
      const queueStats = document.getElementById('queueStats');
      const total = analytics.queue.total || 1;
      
      queueStats.innerHTML = `
        <div class="stat-row">
          <div class="stat-label">‚úÖ Completed</div>
          <div class="stat-value">${analytics.queue.completed}</div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${(analytics.queue.completed / total * 100)}%"></div>
        </div>

        <div class="stat-row">
          <div class="stat-label">üîÑ In Progress</div>
          <div class="stat-value">${analytics.queue.inProgress}</div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${(analytics.queue.inProgress / total * 100)}%"></div>
        </div>

        <div class="stat-row">
          <div class="stat-label">üì• Pending</div>
          <div class="stat-value">${analytics.queue.pending}</div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${(analytics.queue.pending / total * 100)}%"></div>
        </div>
      `;

      // Team stats
      const teamStats = document.getElementById('teamStats');
      teamStats.innerHTML = `
        <div class="stat-row">
          <div class="stat-label">Average Tasks per Agent</div>
          <div class="stat-value">${analytics.metrics.avgTasksPerAgent}</div>
        </div>
        <div class="stat-row">
          <div class="stat-label">Hourly Completions</div>
          <div class="stat-value">${analytics.metrics.hourlyCompletions}</div>
        </div>
        <div class="stat-row">
          <div class="stat-label">Total Tasks Processed</div>
          <div class="stat-value">${analytics.queue.total}</div>
        </div>
      `;
    }

    // Initial load
    fetchAnalytics();
    fetchMarketData();
    fetchSalesData();
    fetchSocialData();

    // Auto-refresh every 10 seconds for analytics
    setInterval(fetchAnalytics, 10000);
    
    // Auto-refresh market data every 30 seconds (CoinGecko rate limit friendly)
    setInterval(fetchMarketData, 30000);
    
    // Auto-refresh sales data every 60 seconds
    setInterval(fetchSalesData, 60000);
    
    // Auto-refresh social data every 5 minutes (300 seconds)
    setInterval(fetchSocialData, 300000);
  </script>
</body>
</html>
