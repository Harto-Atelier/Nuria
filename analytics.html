<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics - Harto Command</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'JetBrains Mono', monospace;
      background: #0a0a0a;
      color: #e0e0e0;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      background: linear-gradient(135deg, #4d57a0 0%, #3a4380 100%);
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px rgba(77, 87, 160, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .subtitle {
      opacity: 0.8;
      font-size: 14px;
    }

    .live-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255,255,255,0.1);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
    }

    .pulse-dot {
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .metric-card {
      background: #1a1a1a;
      border: 2px solid #2a2a2a;
      border-radius: 12px;
      padding: 24px;
      transition: all 0.3s ease;
    }

    .metric-card:hover {
      border-color: #4d57a0;
      transform: translateY(-2px);
    }

    .metric-label {
      font-size: 12px;
      opacity: 0.6;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .metric-value {
      font-size: 48px;
      font-weight: 700;
      background: linear-gradient(135deg, #4d57a0 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .metric-change {
      font-size: 14px;
      margin-top: 8px;
    }

    .metric-change.positive {
      color: #22c55e;
    }

    .metric-change.negative {
      color: #ef4444;
    }

    .chart-container {
      background: #1a1a1a;
      border: 2px solid #2a2a2a;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 30px;
    }

    .chart-header {
      margin-bottom: 20px;
    }

    .chart-title {
      font-size: 20px;
      font-weight: 700;
    }

    .progress-bar {
      height: 8px;
      background: #2a2a2a;
      border-radius: 4px;
      overflow: hidden;
      margin: 12px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4d57a0 0%, #3b82f6 100%);
      transition: width 0.5s ease;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      background: #0f0f0f;
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .stat-label {
      opacity: 0.7;
    }

    .stat-value {
      font-weight: 600;
    }

    nav {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: flex;
      gap: 12px;
    }

    .nav-btn {
      background: linear-gradient(135deg, #4d57a0 0%, #3a4380 100%);
      border: none;
      color: white;
      padding: 16px 24px;
      border-radius: 30px;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(77, 87, 160, 0.4);
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .nav-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 24px rgba(77, 87, 160, 0.5);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>üìä Analytics Dashboard</h1>
        <div class="subtitle">Real-time team performance metrics</div>
      </div>
      <div class="live-indicator">
        <div class="pulse-dot"></div>
        <span>LIVE</span>
      </div>
    </header>

    <div class="metrics-grid" id="metricsGrid">
      <!-- Metrics will be populated by JavaScript -->
    </div>

    <!-- Market Watch Section -->
    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">üåç Market Watch</div>
      </div>
      <div class="metrics-grid" id="marketMetrics">
        <!-- Market metrics will be populated by JavaScript -->
      </div>
    </div>

    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">Task Queue Status</div>
      </div>
      <div id="queueStats"></div>
    </div>

    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">Team Performance</div>
      </div>
      <div id="teamStats"></div>
    </div>

    <nav>
      <a href="team-status-live.html" class="nav-btn">üë• Team</a>
      <button class="nav-btn" onclick="location.reload()">üîÑ Refresh</button>
    </nav>
  </div>

  <script>
    let analytics = null;
    let marketData = null;

    async function fetchMarketData() {
      try {
        // Fetch BTC price from CoinGecko (free API)
        const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true&include_market_cap=true');
        const data = await response.json();
        
        marketData = {
          btcPrice: data.bitcoin.usd,
          btcChange24h: data.bitcoin.usd_24h_change,
          btcMarketCap: data.bitcoin.usd_market_cap
        };
        
        renderMarketMetrics();
      } catch (error) {
        console.error('Error fetching market data:', error);
        // Show fallback UI
        document.getElementById('marketMetrics').innerHTML = `
          <div class="metric-card" style="grid-column: 1 / -1; text-align: center; opacity: 0.5;">
            Unable to load market data. Check connection.
          </div>
        `;
      }
    }

    function renderMarketMetrics() {
      if (!marketData) return;

      const marketMetrics = document.getElementById('marketMetrics');
      const changeColor = marketData.btcChange24h > 0 ? 'positive' : 'negative';
      const changeIcon = marketData.btcChange24h > 0 ? '‚Üë' : '‚Üì';
      
      marketMetrics.innerHTML = `
        <div class="metric-card">
          <div class="metric-label">‚Çø Bitcoin Price</div>
          <div class="metric-value">$${marketData.btcPrice.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</div>
          <div class="metric-change ${changeColor}">
            ${changeIcon} ${Math.abs(marketData.btcChange24h).toFixed(2)}% (24h)
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Market Cap</div>
          <div class="metric-value">$${(marketData.btcMarketCap / 1e9).toFixed(1)}B</div>
          <div class="metric-change" style="opacity: 0.5;">
            Global market dominance
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-label">24h Performance</div>
          <div class="metric-value" style="color: ${marketData.btcChange24h > 0 ? '#22c55e' : '#ef4444'}">
            ${marketData.btcChange24h > 0 ? '+' : ''}${marketData.btcChange24h.toFixed(2)}%
          </div>
          <div class="metric-change" style="opacity: 0.5;">
            ${marketData.btcChange24h > 5 ? 'üî• Hot momentum' : marketData.btcChange24h < -5 ? '‚ùÑÔ∏è Cool down' : 'üìä Steady'}
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Ordinals Market</div>
          <div class="metric-value" style="font-size: 24px;">Active</div>
          <div class="metric-change" style="opacity: 0.5;">
            <a href="https://magiceden.io/ordinals" target="_blank" style="color: #4d57a0; text-decoration: none;">View on Magic Eden ‚Üí</a>
          </div>
        </div>
      `;
    }

    async function fetchAnalytics() {
      try {
        const response = await fetch('data/analytics.json');
        analytics = await response.json();
        renderMetrics();
        renderCharts();
      } catch (error) {
        console.error('Error fetching analytics:', error);
      }
    }

    function renderMetrics() {
      if (!analytics) return;

      const metricsGrid = document.getElementById('metricsGrid');
      const metrics = [
        {
          label: 'Completion Rate',
          value: analytics.metrics.completionRate + '%',
          change: null
        },
        {
          label: 'Active Agents',
          value: analytics.metrics.activeAgents,
          change: null
        },
        {
          label: 'Tasks/Hour',
          value: analytics.trends.tasksPerHour,
          change: null
        },
        {
          label: 'Utilization',
          value: analytics.trends.utilizationRate + '%',
          change: null
        }
      ];

      metricsGrid.innerHTML = metrics.map(metric => `
        <div class="metric-card">
          <div class="metric-label">${metric.label}</div>
          <div class="metric-value">${metric.value}</div>
          ${metric.change ? `<div class="metric-change ${metric.change > 0 ? 'positive' : 'negative'}">
            ${metric.change > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(metric.change)}%
          </div>` : ''}
        </div>
      `).join('');
    }

    function renderCharts() {
      if (!analytics) return;

      // Queue stats
      const queueStats = document.getElementById('queueStats');
      const total = analytics.queue.total || 1;
      
      queueStats.innerHTML = `
        <div class="stat-row">
          <div class="stat-label">‚úÖ Completed</div>
          <div class="stat-value">${analytics.queue.completed}</div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${(analytics.queue.completed / total * 100)}%"></div>
        </div>

        <div class="stat-row">
          <div class="stat-label">üîÑ In Progress</div>
          <div class="stat-value">${analytics.queue.inProgress}</div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${(analytics.queue.inProgress / total * 100)}%"></div>
        </div>

        <div class="stat-row">
          <div class="stat-label">üì• Pending</div>
          <div class="stat-value">${analytics.queue.pending}</div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${(analytics.queue.pending / total * 100)}%"></div>
        </div>
      `;

      // Team stats
      const teamStats = document.getElementById('teamStats');
      teamStats.innerHTML = `
        <div class="stat-row">
          <div class="stat-label">Average Tasks per Agent</div>
          <div class="stat-value">${analytics.metrics.avgTasksPerAgent}</div>
        </div>
        <div class="stat-row">
          <div class="stat-label">Hourly Completions</div>
          <div class="stat-value">${analytics.metrics.hourlyCompletions}</div>
        </div>
        <div class="stat-row">
          <div class="stat-label">Total Tasks Processed</div>
          <div class="stat-value">${analytics.queue.total}</div>
        </div>
      `;
    }

    // Initial load
    fetchAnalytics();
    fetchMarketData();

    // Auto-refresh every 10 seconds for analytics
    setInterval(fetchAnalytics, 10000);
    
    // Auto-refresh market data every 30 seconds (CoinGecko rate limit friendly)
    setInterval(fetchMarketData, 30000);
  </script>
</body>
</html>
